<div class="drawing-toolbar" [class.disabled]="disabled">
  <!-- Node Autocomplete (place nodes from system) -->
  @if (availableNodes.length > 0) {
    <div class="tool-group node-autocomplete">
      <mat-form-field appearance="outline" class="node-select">
        <mat-label>Add Node</mat-label>
        <input
          type="text"
          matInput
          [formControl]="nodeSearchControl"
          [matAutocomplete]="nodeAuto"
          placeholder="Search by number..."
          [disabled]="disabled">
        <mat-autocomplete
          #nodeAuto="matAutocomplete"
          [displayWith]="displayFn"
          (optionSelected)="onAutocompleteNodeSelected($event.option.value)">
          @for (node of filteredNodes$ | async; track node.id) {
            <mat-option [value]="node">
              {{ node.nodeNumber }}
            </mat-option>
          }
        </mat-autocomplete>
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <mat-divider vertical></mat-divider>
  }

  <!-- Zone Drawing Tools -->
  <div class="tool-group">
    <!-- Rectangle Zone (drag to draw) -->
    <button
      mat-icon-button
      [class.active]="isActive('drawRect')"
      (click)="setMode(isActive('drawRect') ? 'select' : 'drawRect')"
      matTooltip="Draw Rectangle Zone (drag to draw)"
      [disabled]="disabled">
      <mat-icon>crop_square</mat-icon>
    </button>

    <!-- Polygon Zone (click points) -->
    <button
      mat-icon-button
      [class.active]="isActive('drawZone')"
      (click)="setMode(isActive('drawZone') ? 'select' : 'drawZone')"
      matTooltip="Draw Polygon Zone (click points)"
      [disabled]="disabled">
      <mat-icon>pentagon</mat-icon>
    </button>

    <!-- Connect Nodes -->
    <button
      mat-icon-button
      [class.active]="isActive('drawLine')"
      (click)="setMode(isActive('drawLine') ? 'select' : 'drawLine')"
      matTooltip="Connect Nodes (click nodes to link them)"
      [disabled]="disabled">
      <mat-icon>timeline</mat-icon>
    </button>
  </div>

  <!-- Zone Drawing Actions (visible when drawing zone) -->
  @if (isDrawingZone) {
    <div class="tool-group zone-actions">
      <button
        mat-icon-button
        color="primary"
        (click)="onFinishZone()"
        matTooltip="Finish Zone (complete polygon)">
        <mat-icon>check</mat-icon>
      </button>

      <button
        mat-icon-button
        color="warn"
        (click)="onCancelDrawing()"
        matTooltip="Cancel Drawing">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  }

  <mat-divider vertical></mat-divider>

  <!-- Image Upload -->
  <div class="tool-group">
    <button
      mat-icon-button
      (click)="onUploadImage()"
      matTooltip="Upload Background Image"
      [disabled]="disabled">
      <mat-icon>image</mat-icon>
    </button>
  </div>

  <mat-divider vertical></mat-divider>

  <!-- Save & Clear -->
  <div class="tool-group">
    <button
      mat-icon-button
      color="primary"
      (click)="onSave()"
      matTooltip="Save Changes"
      [disabled]="disabled || !hasUnsavedChanges">
      <mat-icon>save</mat-icon>
    </button>

    <button
      mat-icon-button
      (click)="onClearAll()"
      matTooltip="Clear All Custom Elements"
      [disabled]="disabled">
      <mat-icon>layers_clear</mat-icon>
    </button>
  </div>

  <!-- Mode Indicator -->
  <div class="mode-indicator">
    @if (isActive('drawRect')) {
      <span class="mode-label highlight">Click and drag to draw rectangle zone</span>
    } @else if (isDrawingZone) {
      <span class="mode-label highlight">Click points to draw zone (double-click to finish)</span>
    } @else if (isActive('drawLine')) {
      <span class="mode-label highlight">Click nodes to connect them • Press Escape to exit</span>
    } @else {
      <span class="mode-label">Right-click for options • Drag to move</span>
    }
  </div>
</div>
