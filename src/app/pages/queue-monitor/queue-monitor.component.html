<div class="queue-monitor-container">
  <!-- Header -->
  <div class="page-header">
    <h1>
      <mat-icon>queue</mat-icon>
      Mission Queue Monitor
    </h1>
    <div class="header-actions">
      <button
        mat-raised-button
        color="primary"
        (click)="refreshData()"
        [disabled]="isLoading">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
      <button
        mat-raised-button
        [color]="autoRefreshEnabled ? 'accent' : ''"
        (click)="toggleAutoRefresh()">
        <mat-icon>{{ autoRefreshEnabled ? 'pause' : 'play_arrow' }}</mat-icon>
        Auto-Refresh: {{ autoRefreshEnabled ? 'ON' : 'OFF' }}
      </button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading && !statistics" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading queue data...</p>
  </div>

  <!-- Statistics Cards -->
  <div *ngIf="statistics" class="statistics-section">
    <h2>Overall Statistics</h2>
    <div class="stats-cards">
      <mat-card class="stat-card pending">
        <mat-card-header>
          <mat-icon>schedule</mat-icon>
          <mat-card-title>Pending</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{ statistics.totalPending }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card processing">
        <mat-card-header>
          <mat-icon>cached</mat-icon>
          <mat-card-title>Processing</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{ statistics.totalProcessing }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card completed">
        <mat-card-header>
          <mat-icon>check_circle</mat-icon>
          <mat-card-title>Completed</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{ statistics.totalCompleted }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card failed">
        <mat-card-header>
          <mat-icon>error</mat-icon>
          <mat-card-title>Failed</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{ statistics.totalFailed }}</div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Map Code Statistics -->
  <div *ngIf="statistics && statistics.mapCodeStatistics.length > 0" class="map-stats-section">
    <h2>Map Code Statistics</h2>
    <div class="map-stats-grid">
      <mat-card *ngFor="let mapStat of statistics.mapCodeStatistics" class="map-stat-card">
        <mat-card-header>
          <mat-card-title>{{ mapStat.mapCode }}</mat-card-title>
          <mat-card-subtitle>Total: {{ mapStat.totalCount }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="map-stat-details">
            <div class="stat-item">
              <span class="stat-label">Pending:</span>
              <mat-chip color="primary">{{ mapStat.pendingCount + mapStat.readyToAssignCount }}</mat-chip>
            </div>
            <div class="stat-item">
              <span class="stat-label">Processing:</span>
              <mat-chip color="accent">{{ mapStat.assignedCount + mapStat.executingCount }}</mat-chip>
            </div>
            <div class="stat-item">
              <span class="stat-label">Completed:</span>
              <mat-chip>{{ mapStat.completedCount }}</mat-chip>
            </div>
            <div class="stat-item">
              <span class="stat-label">Failed:</span>
              <mat-chip color="warn">{{ mapStat.failedCount }}</mat-chip>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Queue Items Section -->
  <div *ngIf="statistics" class="queue-items-section">
    <h2>Queue Items</h2>

    <!-- Filters -->
    <div class="filters">
      <mat-form-field appearance="outline">
        <mat-label>Map Code</mat-label>
        <mat-select [(ngModel)]="selectedMapCode" (selectionChange)="onMapCodeChange()">
          <mat-option *ngFor="let mapCode of availableMapCodes" [value]="mapCode">
            {{ mapCode }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Status Filter</mat-label>
        <mat-select [(ngModel)]="statusFilter" (selectionChange)="onStatusFilterChange()">
          <mat-option value="">All Statuses</mat-option>
          <mat-option value="Pending">Pending</mat-option>
          <mat-option value="ReadyToAssign">Ready To Assign</mat-option>
          <mat-option value="Assigned">Assigned</mat-option>
          <mat-option value="Executing">Executing</mat-option>
          <mat-option value="Completed">Completed</mat-option>
          <mat-option value="Failed">Failed</mat-option>
          <mat-option value="Cancelled">Cancelled</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- Queue Items Table -->
    <app-generic-table
      [data]="queueItems"
      [config]="tableConfig"
      [loading]="isLoading"
      (action)="onTableAction($event)">
    </app-generic-table>
  </div>

  <!-- Empty State -->
  <div *ngIf="!statistics && !isLoading" class="empty-state">
    <mat-icon>inbox</mat-icon>
    <h3>No Queue Data Available</h3>
    <p>There are no queued missions at the moment.</p>
    <button mat-raised-button color="primary" (click)="refreshData()">
      <mat-icon>refresh</mat-icon>
      Refresh
    </button>
  </div>
</div>
