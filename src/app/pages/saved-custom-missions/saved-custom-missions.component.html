<!-- Loading Progress -->
<div class="loading-container" *ngIf="isLoading">
  <mat-progress-bar
    mode="indeterminate"
    class="loading-progress">
  </mat-progress-bar>
</div>

<!-- Generic Table Component -->
<app-generic-table class="saved-custom-missions-table"
  [data]="savedCustomMissions"
  [config]="tableConfig"
  [loading]="isLoading"
  [empty]="savedCustomMissions.length === 0"
  (action)="onTableAction($event)"
  (sortChange)="onSortChange($event)"
  (pageChange)="onPageChange($event)"
  (filterChange)="onFilterChange($event)">
</app-generic-table>

<!-- Custom Mission Name Cell Template -->
<ng-template #missionNameCell let-data let-column="column">
  <div class="mission-name-cell">
    <mat-icon class="mission-icon" [matTooltip]="'Mission ID: ' + data.id">save</mat-icon>
    <span class="mission-name" [matTooltip]="data.description || data.missionName">
      {{ getCellValue(data, column) }}
    </span>
    <mat-chip-listbox class="mission-badges">
      <mat-chip-option
        *ngIf="hasActiveSchedules(data)"
        class="schedule-chip"
        [matTooltip]="'Active schedules: ' + data.activeSchedules">
        <mat-icon class="chip-icon">schedule</mat-icon>
        {{ data.activeSchedules }}
      </mat-chip-option>
    </mat-chip-listbox>
  </div>
</ng-template>

<!-- Custom Priority Cell Template -->
<ng-template #priorityCell let-data let-column="column">
  <span class="priority-badge"
        [ngClass]="getPriorityClass(data.priority)"
        [matTooltip]="'Priority: ' + getPriorityDisplay(data.priority)">
    <mat-icon class="priority-icon" *ngIf="data.priority === 'CRITICAL'">priority_high</mat-icon>
    <mat-icon class="priority-icon" *ngIf="data.priority === 'HIGH'">arrow_upward</mat-icon>
    <mat-icon class="priority-icon" *ngIf="data.priority === 'MEDIUM'">remove</mat-icon>
    <mat-icon class="priority-icon" *ngIf="data.priority === 'LOW'">arrow_downward</mat-icon>
    {{ getPriorityDisplay(data.priority) }}
  </span>
</ng-template>

<!-- Custom Schedules Cell Template -->
<ng-template #schedulesCell let-data let-column="column">
  <div class="schedules-cell">
    <span class="schedules-count"
          [matTooltip]="'Active: ' + data.activeSchedules + ' / Total: ' + data.totalSchedules.split('/')[1]">
      <mat-icon class="schedule-icon" [ngClass]="{'has-schedules': hasActiveSchedules(data)}">event</mat-icon>
      {{ getCellValue(data, column) }}
    </span>
    <mat-chip-listbox class="schedule-badges">
      <mat-chip-option
        *ngIf="isScheduled(data)"
        class="next-run-chip"
        [matTooltip]="'Next run: ' + data.nextRunUtc">
        <mat-icon class="chip-icon">alarm</mat-icon>
        Scheduled
      </mat-chip-option>
    </mat-chip-listbox>
  </div>
</ng-template>

<!-- Custom Next Run Cell Template -->
<ng-template #nextRunCell let-data let-column="column">
  <span class="next-run"
        [matTooltip]="'Next scheduled execution: ' + (data.nextRunUtc === 'Not scheduled' ? 'No schedule configured' : data.nextRunUtc)"
        [ngClass]="{'no-schedule': !isScheduled(data)}">
    <mat-icon class="next-run-icon" *ngIf="isScheduled(data)">alarm</mat-icon>
    <mat-icon class="next-run-icon" *ngIf="!isScheduled(data)">event_busy</mat-icon>
    {{ getCellValue(data, column) }}
  </span>
</ng-template>

<!-- Custom Last Status Cell Template -->
<ng-template #lastStatusCell let-data let-column="column">
  <span class="status-badge"
        [ngClass]="getStatusClass(data.lastStatus)"
        [matTooltip]="'Last execution status: ' + (data.lastStatus === 'Never run' ? 'Mission has not been executed yet' : data.lastStatus)">
    <mat-icon class="status-icon" *ngIf="data.lastStatus === 'COMPLETED'">check_circle</mat-icon>
    <mat-icon class="status-icon" *ngIf="data.lastStatus === 'FAILED'">error</mat-icon>
    <mat-icon class="status-icon" *ngIf="data.lastStatus === 'RUNNING'">play_circle</mat-icon>
    <mat-icon class="status-icon" *ngIf="data.lastStatus === 'CANCELLED'">cancel</mat-icon>
    <mat-icon class="status-icon" *ngIf="data.lastStatus === 'PENDING'">schedule</mat-icon>
    <mat-icon class="status-icon" *ngIf="!data.lastStatus || data.lastStatus === 'Never run'">help_outline</mat-icon>
    {{ getCellValue(data, column) }}
  </span>
</ng-template>

<!-- Custom Created By Cell Template -->
<ng-template #createdByCell let-data let-column="column">
  <span class="created-by" [matTooltip]="'Created by: ' + data.createdBy">
    <mat-icon class="user-icon">person</mat-icon>
    {{ getCellValue(data, column) }}
  </span>
</ng-template>

<!-- Custom Created Date Cell Template -->
<ng-template #createdDateCell let-data let-column="column">
  <span class="created-date" [matTooltip]="'Created: ' + data.createdUtc">
    <mat-icon class="date-icon">event</mat-icon>
    {{ getCellValue(data, column) }}
  </span>
</ng-template>

<!-- Custom Robot Models Cell Template -->
<ng-template #robotModelsCell let-data let-column="column">
  <span class="robot-models" [matTooltip]="'Robot models: ' + data.robotModels">
    <mat-icon class="robot-icon">smart_toy</mat-icon>
    {{ getCellValue(data, column) }}
  </span>
</ng-template>

<!-- Custom Mission Type Cell Template -->
<ng-template #missionTypeCell let-data let-column="column">
  <span class="mission-type-badge" [matTooltip]="'Mission type: ' + data.missionType">
    <mat-icon class="mission-type-icon">category</mat-icon>
    {{ getMissionTypeDisplay(data.missionType) }}
  </span>
</ng-template>

<!-- Custom Robot Type Cell Template -->
<ng-template #robotTypeCell let-data let-column="column">
  <span class="robot-type-badge" [matTooltip]="'Robot type: ' + data.robotType">
    <mat-icon class="robot-type-icon">precision_manufacturing</mat-icon>
    {{ getCellValue(data, column) }}
  </span>
</ng-template>

<!-- Custom Description Cell Template -->
<ng-template #descriptionCell let-data let-column="column">
  <span class="description" [matTooltip]="data.description || 'No description provided'">
    <mat-icon class="description-icon">description</mat-icon>
    {{ getCellValue(data, column) }}
  </span>
</ng-template>